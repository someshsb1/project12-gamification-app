@model Gamification.UI.Models.SapViewModel
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@if (User.IsInRole("User"))
{
    <div class="row">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ECPJX21DQD"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'G-ECPJX21DQD');
        </script>
        <div class="col-lg-8 mb-4 order-0">
            <div class="card">
                <div class="d-flex align-items-end row">
                    <div class="col-sm-7">
                        <div class="card-body">
                            @*<h5 class="card-title text-primary">Congratulations <span id="userName">@Model.Data.User</span>! 🎉</h5>*@
                            <h5 class="card-title text-primary">Congratulations <span @*id="userName"*@>@User.Identity.Name</span>! 🎉</h5>
                            <p class="mb-4">

                                You have completed <span class="fw-bold" @* id="pTitle"*@></span><span id="fulFillment" class="text-primary"><strong>@ViewBag.Fulfillment</strong></span><strong><span class="text-primary">%</span></strong> of the
                                <strong><span id="process" class="text-primary"></span></strong>
! Continue the steps to earn more points and badges.
                            </p>
                            <a href="javascript:;" class="btn btn-sm btn-outline-primary">Back to SAP</a>
                        </div>
                    </div>
                    <div class="col-sm-5 text-center text-sm-left">
                        <div class="card-body pb-0 px-0 px-md-4">
                            <img src="../assets/img/illustrations/man-with-laptop-light.png"
                                 height="140"
                                 alt="View Badge User"
                                 data-app-dark-img="illustrations/man-with-laptop-dark.png"
                                 data-app-light-img="illustrations/man-with-laptop-light.png" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-4 order-1">
            <div class="row">
                <div class="col-6 mb-4">


                    <div class="card">
                        <div class="card-body">
                            <div class="card-title d-flex align-items-start justify-content-between">
                                <div class="avatar flex-shrink-0">
                                    <span class="badge bg-label-info p-2">
                                        <i class="bx bxs-star-half text-primary bx-md"></i>
                                    </span>
                                </div>
                            </div>
                            <span class="d-block mb-1">Points</span>
                            <h3 class="card-title text-nowrap mb-2"><span id="casePoints">@ViewBag.Point</span></h3>
                            <small class="text-danger fw-semibold"><i class="bx bx-up-arrow-alt"></i>next step +10</small>
                        </div>
                    </div>



                </div>
                <div class="col-lg-6 col-md-12 col-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-title d-flex align-items-start justify-content-between">
                                <div class="avatar flex-shrink-0">
                                    <span class="badge bg-label-info p-2"><i class="bx bxs-badge text-success bx-md"></i></span>
                                </div>

                            </div>
                            <span>Badges</span>
                            <h6 class="card-title text-wrap mb-2 p-2"><span id="caseBadges">@ViewBag.Badge</span></h6>
                            <small class="text-success fw-semibold "><i class="bx bx-up-arrow-alt"></i>next badge</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Total Revenue -->
        <div class="col-12 col-lg-8 order-2 order-md-3 order-lg-2 mb-4">
            <div class="card">
                <div class="row row-bordered g-0">
                    <div class="col-md-8">
                        <h5 class="card-header m-0 me-2 pb-3">Score</h5>
                        <div id="charts" class="px-2"></div>
                    </div>
                    <div class="col-md-4">
                        <div class="card-body">
                        </div>
                        <div id="growthChart"></div>

                    </div>
                </div>
            </div>
        </div>
        <!--/ Total Revenue -->
        <div class="col-12 col-md-8 col-lg-4 order-3 order-md-2">
            <div class="row">
                <div class="col-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-title d-flex align-items-start justify-content-between">
                                <div class="avatar flex-shrink-0">
                                    <span class="badge bg-label-info p-2"><i class="bx bxs-crown text-warning bx-md"></i></span>
                                </div>
                            </div>
                            <span class="d-block mb-1">Levels</span>
                            <h3 class="card-title text-nowrap mb-2"><span id="caseLevels">@ViewBag.Levels</span></h3>
                            <small class="text-danger fw-semibold"><i class="bx bx-up-arrow-alt"></i>next step +1</small>
                        </div>
                    </div>
                </div>
                <div class="col-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-title d-flex align-items-start justify-content-between">
                                <div class="avatar flex-shrink-0">
                                    <span class="badge bg-label-info p-2"><i class="bx bx-medal text-info bx-md"></i></span>
                                </div>

                            </div>
                            <span class="fw-semibold d-block mb-1">Medals</span>
                            <h3 class="card-title mb-2">0</h3>
                            <small class="text-success fw-semibold"><i class="bx bx-up-arrow-alt"></i>next step +5</small>
                        </div>
                    </div>
                </div>
                <!-- </div>
                <div class="row"> -->
                <div class="col-12 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between flex-sm-row flex-column gap-3">
                                <div class="d-flex flex-sm-column flex-row align-items-start justify-content-between">
                                    <div class="card-title">
                                        <h5 class="text-nowrap mb-2">Steps Report</h5>
                                        <span class="badge bg-label-warning rounded-pill">Total steps <span>@ViewBag.StepsCount</span></span>
                                    </div>
                                    @*<div class="mt-sm-auto">
                                        <small class="text-success text-nowrap fw-semibold"><i class="bx bx-chevron-up"></i> completed</small>
                                        <h3 class="mb-0">2</h3>
                                    </div>*@
                                </div>
                                @*<div id="profileReportChart"></div>*@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="row">
        <div class="col-sm-12">

            <div class="alert alert-custom alert-outline-primary fade show mb-5" role="alert">
                <div class="alert-icon"><i class="flaticon-warning"></i></div>
                <div class="alert-text">
                    <marquee>Welcome @User.Identity.Name</marquee>
                </div>
                <div class="alert-close">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true"><i class="ki ki-close"></i></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@section scripts{
    <partial name="_ValidationScriptsPartial"/>
    <script type="text/javascript">
        $("#process").text(returnProcess(firstValue));
        localStorage.clear();
        $(document).ready(function() {
            setData($("#casePoints").text(), $("#caseLevels").text(), $("#caseBadges").text());

            var steps = '@Html.Raw(Json.Serialize(ViewBag.StepsList))';
            var points = '@Html.Raw(Json.Serialize(ViewBag.PointsList))';

            var pointsArray = JSON.parse(points);
            var stepsArray = JSON.parse(steps);
            

            plotGraph(pointsArray, stepsArray);

            
    });
        $(window).on("load", function () {
            showStoredData();
        });

    </script>
}



